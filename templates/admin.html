<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Trang Quản Trị - {{ teacher_name }}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* GIỮ NGUYÊN TOÀN BỘ CSS GỐC CỦA BẠN */
        body { background-color: #0f172a; color: white; font-family: sans-serif; margin: 0; }
        .navbar { background: #1e293b; padding: 10px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; }
        .container { padding: 30px 60px; max-width: 1200px; margin: auto; }
        .admin-banner { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; }
        .avatar-circle { border: 2px solid #eab308; padding: 10px; border-radius: 50%; font-size: 25px; color: #eab308; }
        .card-row { display: flex; gap: 20px; margin-bottom: 40px; }
        .card { flex: 1; padding: 25px; border-radius: 12px; cursor: pointer; transition: 0.3s; position: relative; border: 1px solid rgba(255,255,255,0.05); }
        .card i { font-size: 24px; margin-bottom: 15px; display: block; width: fit-content; padding: 8px; border-radius: 6px; }
        .card-yellow { background: rgba(113, 63, 18, 0.2); color: #facc15; }
        .card-green { background: rgba(6, 78, 59, 0.2); color: #34d399; }
        .card-red { background: rgba(127, 29, 29, 0.2); color: #f87171; }
        .card:hover { transform: translateY(-5px); background-color: rgba(255,255,255,0.1); }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); }
        .modal-content { background: #1e293b; margin: 2% auto; padding: 25px; width: 580px; border-radius: 12px; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .modal-header { font-size: 18px; font-weight: bold; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }
        input, select { width: 100%; padding: 10px; background: #2d3748; border: 1px solid #4a5568; color: white; border-radius: 6px; margin-bottom: 12px; box-sizing: border-box; outline: none; }
        label { font-size: 12px; color: #a0aec0; display: block; margin-bottom: 4px; }
        .btn-footer { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }
        .btn-action { padding: 10px 25px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; }
        .file-input-wrapper { background: #0f172a; padding: 10px; border-radius: 6px; border: 1px dashed #4a5568; margin-bottom: 15px; text-align: center; cursor: pointer; }
        .file-input-wrapper:hover { border-color: #3b82f6; }
        
        /* CSS CHO BẢNG DUYỆT TIỀN */
        .approve-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .approve-table th, .approve-table td { padding: 12px; text-align: left; border-bottom: 1px solid #334155; }
        .btn-check { background: #22c55e; color: white; border: none; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="navbar">
    <div style="color:#eab308; font-size: 13px;"><i class="fas fa-user-edit"></i> {{ teacher_name }}</div>
    <div style="text-transform: uppercase; font-weight: bold; font-size: 18px;">Luyện thi trực tuyến</div>
    <div style="display:flex; align-items:center; gap:15px;">
        <i class="fas fa-home"></i>
        <span style="background:#0369a1; padding: 4px 12px; border-radius: 12px; font-size: 12px;"><i class="fas fa-user-graduate"></i> Thầy Hải</span>
    </div>
</div>

<div class="container">
    <div class="admin-banner">
        <div class="avatar-circle"><i class="fas fa-user-tie"></i></div>
        <div>
            <h1 style="margin:0; font-size: 28px;">TRANG QUẢN TRỊ</h1>
            <div style="color:#eab308; font-weight:bold;">{{ teacher_name }}</div>
        </div>
    </div>

    <div class="card-row">
        <div class="card card-yellow" onclick="location.href='/admin/grades'">
    <i class="fas fa-table" style="background:#713f12"></i>
    <h3>QUẢN LÝ ĐIỂM</h3>
    <p>Xem điểm theo lớp & đề thi.</p>
</div>
        <div class="card card-green" onclick="openM('addM')">
            <i class="fas fa-plus" style="background:#064e3b"></i>
            <h3>THÊM ĐỀ THI</h3>
            <p>Upload PDF và File Đáp án.</p>
        </div>
        <div class="card card-red" onclick="openM('delM')">
            <i class="fas fa-trash" style="background:#7f1d1d"></i>
            <h3>XÓA ĐỀ THI</h3>
            <p>Xóa dữ liệu đề thi cũ.</p>
        </div>
    </div>

    <div style="background: #1e293b; padding: 25px; border-radius: 12px; border: 1px solid #334155;">
        <h3 style="color: #eab308; margin-top: 0;"><i class="fas fa-money-check-alt"></i> YÊU CẦU NẠP TIỀN CHỜ DUYỆT</h3>
        <table class="approve-table">
            <thead>
                <tr style="color: #94a3b8; font-size: 13px;">
                    <th>Học sinh</th>
                    <th>Số tiền</th>
                    <th>Thời gian</th>
                    <th style="text-align: center;">Hành động</th>
                </tr>
            </thead>
            <tbody>
                {% for req in waiting_list %}
                <tr>
                    <td><b>{{ req.name }}</b></td>
                    <td style="color: #22c55e; font-weight: bold;">{{ "{:,.0f}".format(req.amount) }}đ</td>
                    <td style="font-size: 12px; color: #94a3b8;">{{ req.time }}</td>
                    <td style="text-align: center;">
                        <form action="/admin/approve_topup" method="POST">
                            <input type="hidden" name="student_name" value="{{ req.name }}">
                            <input type="hidden" name="req_id" value="{{ req.id }}">
                            <button type="submit" class="btn-check">DUYỆT TIỀN</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
                {% if not waiting_list %}
                <tr><td colspan="4" style="text-align: center; color: #475569; padding: 20px;">Không có yêu cầu nạp tiền nào.</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <div style="text-align: center; margin-top: 40px;">
        <a href="/logout" style="background: #2d3748; color: #cbd5e0; padding: 10px 35px; border-radius: 20px; text-decoration: none; border: 1px solid #4a5568; display: inline-flex; align-items: center; gap: 8px;">
            <i class="fas fa-sign-out-alt"></i> ĐĂNG XUẤT
        </a>
    </div>
</div>

<div id="addM" class="modal">
    <div class="modal-content">
        <div class="modal-header" style="color:#22c55e"><i class="fas fa-cloud-upload-alt"></i> THÊM ĐỀ THI MỚI</div>
        <form action="{{ url_for('add_exam') }}" method="POST" enctype="multipart/form-data">
            <div style="display:flex; gap:10px;">
                <div style="flex:1"><label>Mã Đề</label><input type="text" name="ma_de" placeholder="VD: 101" required></div>
                <div style="flex:1">
                    <label>Khối Lớp</label>
                    <select name="khoi_lop" required>
                        <option value="">-- Chọn --</option>
                        <option value="Lớp 6">Lớp 6</option><option value="Lớp 7">Lớp 7</option>
                        <option value="Lớp 8">Lớp 8</option><option value="Lớp 9">Lớp 9</option>
                        <option value="Lớp 10">Lớp 10</option><option value="Lớp 11">Lớp 11</option>
                        <option value="Lớp 12">Lớp 12</option><option value="LT Đại Học">LT Đại Học</option>
                    </select>
                </div>
                <div style="flex:1"><label>Thời gian (phút)</label><input type="number" name="thoi_gian" placeholder="50" required></div>
            </div>
            <label>Tên Đề Thi</label><input type="text" name="ten_de" required>
            
            <label>Tải lên File PDF Đề Thi</label>
            <div class="file-input-wrapper">
                <input type="file" name="file_pdf" accept="application/pdf" required>
            </div>

            <label>Tải lên Bài giải chi tiết (PDF)</label>
            <div class="file-input-wrapper" style="border-color: #eab308;">
                <input type="file" name="file_sol" accept="application/pdf">
            </div>

            <label>Tải lên File Đáp án (Excel)</label>
            <div class="file-input-wrapper" style="border-color: #22c55e;">
                <input type="file" name="file_ans" accept=".xlsx" required>
            </div>
            <p style="font-size: 10px; color: #94a3b8; margin-top: -5px;">* File Excel cần 2 cột: <b>Phan</b> và <b>DapAn</b>.</p>

            <div class="btn-footer">
                <button type="button" class="btn-action" style="background:#4a5568; color:white;" onclick="closeM('addM')">Hủy</button>
                <button type="submit" class="btn-action" style="background:#22c55e; color:white;">LƯU HỆ THỐNG</button>
            </div>
        </form>
    </div>
</div>

<div id="delM" class="modal">
    <div class="modal-content" style="width:420px; text-align:center;">
        <div style="background:#ef4444; width:55px; height:55px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 15px;">
            <i class="fas fa-trash-alt" style="font-size:22px; color: white;"></i>
        </div>
        <h3 style="color:#f87171">CHỌN ĐỀ THI CẦN XÓA</h3>
        <form action="{{ url_for('delete_exam') }}" method="POST" onsubmit="return confirm('Bạn có chắc chắn muốn xóa vĩnh viễn đề thi này?')">
            <select name="ma_de_xoa" required>
                <option value="">-- Chọn đề thi --</option>
                {% for id, ex in exams.items() %}
                <option value="{{ id }}">{{ id }} - {{ ex.name }}</option>
                {% endfor %}
            </select>
            <div class="btn-footer" style="justify-content:center;">
                <button type="button" class="btn-action" style="background:#4a5568; color:white;" onclick="closeM('delM')">Hủy bỏ</button>
                <button type="submit" class="btn-action" style="background:#ef4444; color:white;">Xác nhận Xóa</button>
            </div>
        </form>
    </div>
</div>

<script>
    function openM(id) { document.getElementById(id).style.display = 'block'; }
    function closeM(id) { document.getElementById(id).style.display = 'none'; }
    window.onclick = function(e) { if(e.target.className==='modal') e.target.style.display='none'; }
</script>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <script>alert("{{ messages[0] }}");</script>
  {% endif %}
{% endwith %}
</body>
</html>